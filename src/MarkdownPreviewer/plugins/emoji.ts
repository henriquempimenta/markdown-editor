import { Decoration, DecorationSet, ViewPlugin, ViewUpdate, WidgetType } from '@uiw/react-codemirror';
import { EditorView } from '@codemirror/view';
import { syntaxTree } from '@codemirror/language';
import { Range } from '@codemirror/state';

const emojiMap: { [key: string]: string } = {
  'joy': 'ğŸ˜‚',
  'heart': 'â¤ï¸',
  '+1': 'ğŸ‘',
  '-1': 'ğŸ‘',
  'tada': 'ğŸ‰',
  'smile': 'ğŸ˜„',
  'laughing': 'ğŸ˜†',
  'blush': 'ğŸ˜Š',
  'smiley': 'ğŸ˜ƒ',
  'relaxed': 'â˜ºï¸',
  'smirk': 'ğŸ˜',
  'heart_eyes': 'ğŸ˜',
  'kissing_heart': 'ğŸ˜˜',
  'kissing_closed_eyes': 'ğŸ˜š',
  'kissing': 'ğŸ˜—',
  'kissing_smiling_eyes': 'ğŸ˜™',
  'stuck_out_tongue_winking_eye': 'ğŸ˜œ',
  'stuck_out_tongue_closed_eyes': 'ğŸ˜',
  'stuck_out_tongue': 'ğŸ˜›',
  'flushed': 'ğŸ˜³',
  'grin': 'ğŸ˜',
  'pensive': 'ğŸ˜”',
  'relieved': 'ğŸ˜Œ',
  'unamused': 'ğŸ˜’',
  'disappointed': 'ğŸ˜',
  'persevere': 'ğŸ˜£',
  'cry': 'ğŸ˜¢',
  'sob': 'ğŸ˜­',
  'joy_cat': 'ğŸ˜¹',
  'heart_eyes_cat': 'ğŸ˜»',
  'smirk_cat': 'ğŸ˜¼',
  'kissing_cat': 'ğŸ˜½',
  'scream_cat': 'ğŸ™€',
  'crying_cat_face': 'ğŸ˜¿',
  'pouting_cat': 'ğŸ˜¾',
  'raised_hands': 'ğŸ™Œ',
  'clap': 'ğŸ‘',
  'wave': 'ğŸ‘‹',
  'thumbsup': 'ğŸ‘',
  'thumbsdown': 'ğŸ‘',
  'ok_hand': 'ğŸ‘Œ',
  'punch': 'ğŸ‘Š',
  'fist': 'âœŠ',
  'v': 'âœŒï¸',
  'point_up': 'â˜ï¸',
  'point_down': 'ğŸ‘‡',
  'point_left': 'ğŸ‘ˆ',
  'point_right': 'ğŸ‘‰',
  'point_up_2': 'ğŸ‘†',
  'raised_hand': 'âœ‹',
  'pray': 'ğŸ™',
  'muscle': 'ğŸ’ª',
  'walking': 'ğŸš¶',
  'runner': 'ğŸƒ',
  'dancer': 'ğŸ’ƒ',
  'couple': 'ğŸ‘«',
  'family': 'ğŸ‘ª',
  'two_men_holding_hands': 'ğŸ‘¬',
  'two_women_holding_hands': 'ğŸ‘­',
  'couplekiss': 'ğŸ’',
  'couple_with_heart': 'ğŸ’‘',
  'dancers': 'ğŸ‘¯',
  'bride_with_veil': 'ğŸ‘°',
  'person_with_blond_hair': 'ğŸ‘±',
  'man_with_gua_pi_mao': 'ğŸ‘²',
  'man_with_turban': 'ğŸ‘³',
  'older_man': 'ğŸ‘´',
  'older_woman': 'ğŸ‘µ',
  'baby': 'ğŸ‘¶',
  'construction_worker': 'ğŸ‘·',
  'princess': 'ğŸ‘¸',
  'japanese_ogre': 'ğŸ‘¹',
  'japanese_goblin': 'ğŸ‘º',
  'ghost': 'ğŸ‘»',
  'angel': 'ğŸ‘¼',
  'alien': 'ğŸ‘½',
  'space_invader': 'ğŸ‘¾',
  'imp': 'ğŸ‘¿',
  'skull': 'ğŸ’€',
  'information_desk_person': 'ğŸ’',
  'guardsman': 'ğŸ’‚',
  'lipstick': 'ğŸ’„',
  'nail_care': 'ğŸ’…',
  'massage': 'ğŸ’†',
  'haircut': 'ğŸ’‡',
  'barber': 'ğŸ’ˆ',
  'syringe': 'ğŸ’‰',
  'pill': 'ğŸ’Š',
  'kiss': 'ğŸ’‹',
  'love_letter': 'ğŸ’Œ',
  'ring': 'ğŸ’',
  'gem': 'ğŸ’',
  'bust_in_silhouette': 'ğŸ‘¤',
  'busts_in_silhouette': 'ğŸ‘¥',
  'speech_balloon': 'ğŸ’¬',
  'footprints': 'ğŸ‘£',
  'thought_balloon': 'ğŸ’­',
  'dog': 'ğŸ¶',
  'wolf': 'ğŸº',
  'cat': 'ğŸ±',
  'mouse': 'ğŸ­',
  'hamster': 'ğŸ¹',
  'rabbit': 'ğŸ°',
  'frog': 'ğŸ¸',
  'tiger': 'ğŸ¯',
  'koala': 'ğŸ¨',
  'bear': 'ğŸ»',
  'pig': 'ğŸ·',
  'pig_nose': 'ğŸ½',
  'cow': 'ğŸ®',
  'boar': 'ğŸ—',
  'monkey_face': 'ğŸµ',
  'monkey': 'ğŸ’',
  'horse': 'ğŸ´',
  'racehorse': 'ğŸ',
  'camel': 'ğŸ«',
  'sheep': 'ğŸ‘',
  'elephant': 'ğŸ˜',
  'panda_face': 'ğŸ¼',
  'snake': 'ğŸ',
  'bird': 'ğŸ¦',
  'baby_chick': 'ğŸ¤',
  'hatched_chick': 'ğŸ¥',
  'hatching_chick': 'ğŸ£',
  'chicken': 'ğŸ”',
  'penguin': 'ğŸ§',
  'turtle': 'ğŸ¢',
  'bug': 'ğŸ›',
  'honeybee': 'ğŸ',
  'ant': 'ğŸœ',
  'beetle': 'ğŸ',
  'snal': 'ğŸŒ',
  'octopus': 'ğŸ™',
  'shell': 'ğŸš',
  'tropical_fish': 'ğŸ ',
  'fish': 'ğŸŸ',
  'dolphin': 'ğŸ¬',
  'whale': 'ğŸ³',
  'whale2': 'ğŸ‹',
  'cow2': 'ğŸ„',
  'ram': 'ğŸ',
  'rat': 'ğŸ€',
  'water_buffalo': 'ğŸƒ',
  'tiger2': 'ğŸ…',
  'rabbit2': 'ğŸ‡',
  'dragon': 'ğŸ‰',
  'goat': 'ğŸ',
  'rooster': 'ğŸ“',
  'dog2': 'ğŸ•',
  'pig2': 'ğŸ–',
  'mouse2': 'ğŸ',
  'ox': 'ğŸ‚',
  'dragon_face': 'ğŸ²',
  'blowfish': 'ğŸ¡',
  'crocodile': 'ğŸŠ',
  'dromedary_camel': 'ğŸª',
  'leopard': 'ğŸ†',
  'cat2': 'ğŸˆ',
  'poodle': 'ğŸ©',
  'feet': 'ğŸ¾',
  'bouquet': 'ğŸ’',
  'cherry_blossom': 'ğŸŒ¸',
  'tulip': 'ğŸŒ·',
  'four_leaf_clover': 'ğŸ€',
  'rose': 'ğŸŒ¹',
  'sunflower': 'ğŸŒ»',
  'hibiscus': 'ğŸŒº',
  'maple_leaf': 'ğŸ',
  'leaves': 'ğŸƒ',
  'fallen_leaf': 'ğŸ‚',
  'herb': 'ğŸŒ¿',
  'mushroom': 'ğŸ„',
  'cactus': 'ğŸŒµ',
  'palm_tree': 'ğŸŒ´',
  'evergreen_tree': 'ğŸŒ²',
  'deciduous_tree': 'ğŸŒ³',
  'chestnut': 'ğŸŒ°',
  'seedling': 'ğŸŒ±',
  'blossom': 'ğŸŒ¼',
  'ear_of_rice': 'ğŸŒ¾',
  'globe_with_meridians': 'ğŸŒ',
  'sun_with_face': 'ğŸŒ',
  'full_moon_with_face': 'ğŸŒ',
  'new_moon_with_face': 'ğŸŒš',
  'new_moon': 'ğŸŒ‘',
  'waxing_crescent_moon': 'ğŸŒ’',
  'first_quarter_moon': 'ğŸŒ“',
  'waxing_gibbous_moon': 'ğŸŒ”',
  'full_moon': 'ğŸŒ•',
  'waning_gibbous_moon': 'ğŸŒ–',
  'last_quarter_moon': 'ğŸŒ—',
  'waning_crescent_moon': 'ğŸŒ˜',
  'last_quarter_moon_with_face': 'ğŸŒœ',
  'first_quarter_moon_with_face': 'ğŸŒ›',
  'moon': 'ğŸŒ”',
  'earth_africa': 'ğŸŒ',
  'earth_americas': 'ğŸŒ',
  'earth_asia': 'ğŸŒ',
  'volcano': 'ğŸŒ‹',
  'milky_way': 'ğŸŒŒ',
  'partly_sunny': 'â›…ï¸',
  'bamboo': 'ğŸ',
  'gift_heart': 'ğŸ’',
  'dolls': 'ğŸ',
  'school_satchel': 'ğŸ’',
  'mortar_board': 'ğŸ“',
  'flags': 'ğŸ',
  'fireworks': 'ğŸ†',
  'sparkler': 'ğŸ‡',
  'wind_chime': 'ğŸ',
  'rice_scene': 'ğŸ‘',
  'jack_o_lantern': 'ğŸƒ',
  'christmas_tree': 'ğŸ„',
  'gift': 'ğŸ',
  'santa': 'ğŸ…',
  'fire': 'ğŸ”¥',
  'sparkles': 'âœ¨',
  'balloon': 'ğŸˆ',
  'confetti_ball': 'ğŸŠ',
  'tanabata_tree': 'ğŸ‹',
  'crossed_flags': 'ğŸŒ',
  'crescent_moon': 'ğŸŒ™',
  'star': 'â­ï¸',
  'star2': 'ğŸŒŸ',
  'dizzy': 'ğŸ’«',
  'zap': 'âš¡ï¸',
  'collision': 'ğŸ’¥',
  'boom': 'ğŸ’¥',
  'droplet': 'ğŸ’§',
  'sweat_drops': 'ğŸ’¦',
  'dash': 'ğŸ’¨',
  'hankey': 'ğŸ’©',
  'poop': 'ğŸ’©',
  'zzz': 'ğŸ’¤',
  'ear': 'ğŸ‘‚',
  'eyes': 'ğŸ‘€',
  'nose': 'ğŸ‘ƒ',
  'tongue': 'ğŸ‘…',
  'lips': 'ğŸ‘„',
  'no_good': 'ğŸ™…',
  'ok_woman': 'ğŸ™†',
  'bow': 'ğŸ™‡',
  'see_no_evil': 'ğŸ™ˆ',
  'hear_no_evil': 'ğŸ™‰',
  'speak_no_evil': 'ğŸ™Š',
  'raising_hand': 'ğŸ™‹',
  'person_frowning': 'ğŸ™',
  'person_with_pouting_face': 'ğŸ™',
  'running_shirt_with_sash': 'ğŸ½',
  'ski': 'ğŸ¿',
  'basketball': 'ğŸ€',
  'checkered_flag': 'ğŸ',
  'snowboarder': 'ğŸ‚',
  'surfer': 'ğŸ„',
  'trophy': 'ğŸ†',
  'horse_racing': 'ğŸ‡',
  'football': 'ğŸˆ',
  'rugby_football': 'ğŸ‰',
  'swimmer': 'ğŸŠ',
  'rowboat': 'ğŸš£',
  'fishing_pole_and_fish': 'ğŸ£',
  'coffee': 'â˜•ï¸',
  'tea': 'ğŸµ',
  'sake': 'ğŸ¶',
  'baby_bottle': 'ğŸ¼',
  'beer': 'ğŸº',
  'beers': 'ğŸ»',
  'cocktail': 'ğŸ¸',
  'tropical_drink': 'ğŸ¹',
  'wine_glass': 'ğŸ·',
  'fork_and_knife': 'ğŸ´',
  'pizza': 'ğŸ•',
  'hamburger': 'ğŸ”',
  'fries': 'ğŸŸ',
  'poultry_leg': 'ğŸ—',
  'meat_on_bone': 'ğŸ–',
  'spaghetti': 'ğŸ',
  'curry': 'ğŸ›',
  'fried_shrimp': 'ğŸ¤',
  'bento': 'ğŸ±',
  'sushi': 'ğŸ£',
  'fish_cake': 'ğŸ¥',
  'rice_ball': 'ğŸ™',
  'rice_cracker': 'ğŸ˜',
  'rice': 'ğŸš',
  'ramen': 'ğŸœ',
  'stew': 'ğŸ²',
  'oden': 'ğŸ¢',
  'dango': 'ğŸ¡',
  'egg': 'ğŸ³',
  'bread': 'ğŸ',
  'doughnut': 'ğŸ©',
  'custard': 'ğŸ®',
  'icecream': 'ğŸ¦',
  'ice_cream': 'ğŸ¨',
  'shaved_ice': 'ğŸ§',
  'birthday': 'ğŸ‚',
  'cake': 'ğŸ°',
  'cookie': 'ğŸª',
  'chocolate_bar': 'ğŸ«',
  'candy': 'ğŸ¬',
  'lollipop': 'ğŸ­',
  'honey_pot': 'ğŸ¯',
  'apple': 'ğŸ',
  'green_apple': 'ğŸ',
  'tangerine': 'ğŸŠ',
  'lemon': 'ğŸ‹',
  'cherries': 'ğŸ’',
  'grapes': 'ğŸ‡',
  'watermelon': 'ğŸ‰',
  'strawberry': 'ğŸ“',
  'peach': 'ğŸ‘',
  'melon': 'ğŸˆ',
  'banana': 'ğŸŒ',
  'pear': 'ğŸ',
  'pineapple': 'ğŸ',
  'sweet_potato': 'ğŸ ',
  'eggplant': 'ğŸ†',
  'tomato': 'ğŸ…',
  'corn': 'ğŸŒ½',
  'house': 'ğŸ ',
  'house_with_garden': 'ğŸ¡',
  'school': 'ğŸ«',
  'office': 'ğŸ¢',
  'post_office': 'ğŸ£',
  'hospital': 'ğŸ¥',
  'bank': 'ğŸ¦',
  'convenience_store': 'ğŸª',
  'love_hotel': 'ğŸ©',
  'hotel': 'ğŸ¨',
  'wedding': 'ğŸ’’',
  'church': 'â›ªï¸',
  'department_store': 'ğŸ¬',
  'european_post_office': 'ğŸ¤',
  'city_sunrise': 'ğŸŒ‡',
  'city_sunset': 'ğŸŒ†',
  'japanese_castle': 'ğŸ¯',
  'european_castle': 'ğŸ°',
  'tent': 'â›ºï¸',
  'factory': 'ğŸ­',
  'tokyo_tower': 'ğŸ—¼',
  'japan': 'ğŸ—¾',
  'mount_fuji': 'ğŸ—»',
  'sunrise_over_mountains': 'ğŸŒ„',
  'sunrise': 'ğŸŒ…',
  'night_with_stars': 'ğŸŒƒ',
  'statue_of_liberty': 'ğŸ—½',
  'bridge_at_night': 'ğŸŒ‰',
  'carousel_horse': 'ğŸ ',
  'rainbow': 'ğŸŒˆ',
  'ferris_wheel': 'ğŸ¡',
  'fountain': 'â›²ï¸',
  'roller_coaster': 'ğŸ¢',
  'ship': 'ğŸš¢',
  'speedboat': 'ğŸš¤',
  'boat': 'â›µï¸',
  'sailboat': 'â›µï¸',
  'rocket': 'ğŸš€',
  'airplane': 'âœˆï¸',
  'seat': 'ğŸ’º',
  'helicopter': 'ğŸš',
  'steam_locomotive': 'ğŸš‚',
  'tram': 'ğŸšŠ',
  'mountain_railway': 'ğŸš',
  'bike': 'ğŸš²',
  'aerial_tramway': 'ğŸš¡',
  'suspension_railway': 'ğŸšŸ',
  'mountain_cableway': 'ğŸš ',
  'tractor': 'ğŸšœ',
  'blue_car': 'ğŸš™',
  'oncoming_automobile': 'ğŸš˜',
  'car': 'ğŸš—',
  'red_car': 'ğŸš—',
  'taxi': 'ğŸš•',
  'oncoming_taxi': 'ğŸš–',
  'articulated_lorry': 'ğŸš›',
  'bus': 'ğŸšŒ',
  'oncoming_bus': 'ğŸš',
  'rotating_light': 'ğŸš¨',
  'police_car': 'ğŸš“',
  'oncoming_police_car': 'ğŸš”',
  'fire_engine': 'ğŸš’',
  'ambulance': 'ğŸš‘',
  'minibus': 'ğŸš',
  'truck': 'ğŸšš',
  'train': 'ğŸš‹',
  'station': 'ğŸš‰',
  'train2': 'ğŸš†',
  'bullettrain_front': 'ğŸš…',
  'bullettrain_side': 'ğŸš„',
  'light_rail': 'ğŸšˆ',
  'monorail': 'ğŸš',
  'railway_car': 'ğŸšƒ',
  'trolleybus': 'ğŸš',
  'ticket': 'ğŸ«',
  'fuelpump': 'â›½ï¸',
  'vertical_traffic_light': 'ğŸš¦',
  'traffic_light': 'ğŸš¥',
  'warning': 'âš ï¸',
  'construction': 'ğŸš§',
  'beginner': 'ğŸ”°',
  'atm': 'ğŸ§',
  'slot_machine': 'ğŸ°',
  'busstop': 'ğŸš',
  'hotsprings': 'â™¨ï¸',
  //'checkered_flag': 'ğŸ',
  'izakaya_lantern': 'ğŸ®',
  'moyai': 'ğŸ—¿',
  'circus_tent': 'ğŸª',
  'performing_arts': 'ğŸ­',
  'round_pushpin': 'ğŸ“',
  'triangular_flag_on_post': 'ğŸš©',
  'jp': 'ğŸ‡¯ğŸ‡µ',
  'kr': 'ğŸ‡°ğŸ‡·',
  'cn': 'ğŸ‡¨ğŸ‡³',
  'us': 'ğŸ‡ºğŸ‡¸',
  'fr': 'ğŸ‡«ğŸ‡·',
  'es': 'ğŸ‡ªğŸ‡¸',
  'it': 'ğŸ‡®ğŸ‡¹',
  'ru': 'ğŸ‡·ğŸ‡º',
  'gb': 'ğŸ‡¬ğŸ‡§',
  'uk': 'ğŸ‡¬ğŸ‡§',
  'de': 'ğŸ‡©ğŸ‡ª',
  'one': '1ï¸âƒ£',
  'two': '2ï¸âƒ£',
  'three': '3ï¸âƒ£',
  'four': '4ï¸âƒ£',
  'five': '5ï¸âƒ£',
  'six': '6ï¸âƒ£',
  'seven': '7ï¸âƒ£',
  'eight': '8ï¸âƒ£',
  'nine': '9ï¸âƒ£',
  'zero': '0ï¸âƒ£',
  'keycap_ten': 'ğŸ”Ÿ',
  '1234': 'ğŸ”¢',
  'hash': '#ï¸âƒ£',
  'symbols': 'ğŸ”£',
  'arrow_up': 'â¬†ï¸',
  'arrow_down': 'â¬‡ï¸',
  'arrow_left': 'â¬…ï¸',
  'arrow_right': 'â¡ï¸',
  'capital_abcd': 'ğŸ” ',
  'abcd': 'ğŸ”¡',
  'abc': 'ğŸ”¤',
  'arrow_upper_right': 'â†—ï¸',
  'arrow_upper_left': 'â†–ï¸',
  'arrow_lower_right': 'â†˜ï¸',
  'arrow_lower_left': 'â†™ï¸',
  'left_right_arrow': 'â†”ï¸',
  'arrow_up_down': 'â†•ï¸',
  'arrows_counterclockwise': 'ğŸ”„',
  'arrow_backward': 'â—€ï¸',
  'arrow_forward': 'â–¶ï¸',
  'arrow_up_small': 'ğŸ”¼',
  'arrow_down_small': 'ğŸ”½',
  'leftwards_arrow_with_hook': 'â†©ï¸',
  'arrow_right_hook': 'â†ªï¸',
  'information_source': 'â„¹ï¸',
  'rewind': 'âª',
  'fast_forward': 'â©',
  'arrow_double_up': 'â«',
  'arrow_double_down': 'â¬',
  'arrow_heading_down': 'â¤µï¸',
  'arrow_heading_up': 'â¤´ï¸',
  'ok': 'ğŸ†—',
  'twisted_rightwards_arrows': 'ğŸ”€',
  'repeat': 'ğŸ”',
  'repeat_one': 'ğŸ”‚',
  'new': 'ğŸ†•',
  'up': 'ğŸ†™',
  'free': 'ğŸ†“',
  'ng': 'ğŸ†–',
  'signal_strength': 'ğŸ“¶',
  'cinema': 'ğŸ¦',
  'koko': 'ğŸˆ',
  'u6307': 'ğŸˆ¯ï¸',
  'u7a7a': 'ğŸˆ³',
  'u6e80': 'ğŸˆµ',
  'u5408': 'ğŸˆ´',
  'u7981': 'ğŸˆ²',
  'ideograph_advantage': 'ğŸ‰',
  'u5272': 'ğŸˆ¹',
  'u55b6': 'ğŸˆº',
  'u6709': 'ğŸˆ¶',
  'u7121': 'ğŸˆšï¸',
  'restroom': 'ğŸš»',
  'mens': 'ğŸš¹',
  'womens': 'ğŸšº',
  'baby_symbol': 'ğŸš¼',
  'wc': 'ğŸš¾',
  'potable_water': 'ğŸš°',
  'put_litter_in_its_place': 'ğŸš®',
  'parking': 'ğŸ…¿ï¸',
  'wheelchair': 'â™¿ï¸',
  'no_smoking': 'ğŸš­',
  'u6708': 'ğŸˆ·ï¸',
  'u7533': 'ğŸˆ¸',
  'sa': 'ğŸˆ‚ï¸',
  'm': 'â“‚ï¸',
  'passport_control': 'ğŸ›‚',
  'baggage_claim': 'ğŸ›„',
  'left_luggage': 'ğŸ›…',
  'customs': 'ğŸ›ƒ',
  'accept': 'ğŸ‰‘',
  'secret': 'ãŠ™ï¸',
  'congratulations': 'ãŠ—ï¸',
  'cl': 'ğŸ†‘',
  'sos': 'ğŸ†˜',
  'id': 'ğŸ†”',
  'no_entry_sign': 'ğŸš«',
  'underage': 'ğŸ”',
  'no_mobile_phones': 'ğŸ“µ',
  'do_not_litter': 'ğŸš¯',
  'non-potable_water': 'ğŸš±',
  'no_bicycles': 'ğŸš³',
  'no_pedestrians': 'ğŸš¶',
  'children_crossing': 'ğŸš¸',
  'no_entry': 'â›”ï¸',
  'eight_spoked_asterisk': 'âœ³ï¸',
  'sparkle': 'â‡ï¸',
  'negative_squared_cross_mark': 'â',
  'white_check_mark': 'âœ…',
  'eight_pointed_black_star': 'âœ´ï¸',
  'heart_decoration': 'ğŸ’Ÿ',
  'vs': 'ğŸ†š',
  'vibration_mode': 'ğŸ“³',
  'mobile_phone_off': 'ğŸ“´',
  'a': 'ğŸ…°ï¸',
  'b': 'ğŸ…±ï¸',
  'ab': 'ğŸ†',
  'o2': 'ğŸ…¾ï¸',
  'diamond_shape_with_a_dot_inside': 'ğŸ’ ',
  'loop': 'â¿',
  'recycle': 'â™»ï¸',
  'aries': 'â™ˆï¸',
  'taurus': 'â™‰ï¸',
  'gemini': 'â™Šï¸',
  'cancer': 'â™‹ï¸',
  'leo': 'â™Œï¸',
  'virgo': 'â™ï¸',
  'libra': 'â™ï¸',
  'scorpius': 'â™ï¸',
  'sagittarius': 'â™ï¸',
  'capricorn': 'â™‘ï¸',
  'aquarius': 'â™’ï¸',
  'pisces': 'â™“ï¸',
  'ophiuchus': 'â›',
  'six_pointed_star': 'ğŸ”¯',
  'chart': 'ğŸ’¹',
  'heavy_dollar_sign': 'ğŸ’²',
  'currency_exchange': 'ğŸ’±',
  'copyright': 'Â©ï¸',
  'registered': 'Â®ï¸',
  'tm': 'â„¢ï¸',
  'x': 'âŒ',
  'bangbang': 'â€¼ï¸',
  'interrobang': 'â‰ï¸',
  'exclamation': 'â—ï¸',
  'heavy_exclamation_mark': 'â—ï¸',
  'question': 'â“',
  'grey_exclamation': 'â•',
  'grey_question': 'â”',
  'o': 'â­•ï¸',
  'top': 'ğŸ”',
  'end': 'ğŸ”š',
  'back': 'ğŸ”™',
  'on': 'ğŸ”›',
  'soon': 'ğŸ”œ',
  'arrows_clockwise': 'ğŸ”ƒ',
  'clock12': 'ğŸ•›',
  'clock1230': 'ğŸ•§',
  'clock1': 'ğŸ•',
  'clock130': 'ğŸ•œ',
  'clock2': 'ğŸ•‘',
  'clock230': 'ğŸ•',
  'clock3': 'ğŸ•’',
  'clock330': 'ğŸ•',
  'clock4': 'ğŸ•“',
  'clock430': 'ğŸ•Ÿ',
  'clock5': 'ğŸ•”',
  'clock530': 'ğŸ• ',
  'clock6': 'ğŸ••',
  'clock7': 'ğŸ•–',
  'clock8': 'ğŸ•—',
  'clock9': 'ğŸ•˜',
  'clock10': 'ğŸ•™',
  'clock11': 'ğŸ•š',
  'clock630': 'ğŸ•¡',
  'clock730': 'ğŸ•¢',
  'clock830': 'ğŸ•£',
  'clock930': 'ğŸ•¤',
  'clock1030': 'ğŸ•¥',
  'clock1130': 'ğŸ•¦',
  'heavy_multiplication_x': 'âœ–ï¸',
  'heavy_plus_sign': 'â•',
  'heavy_minus_sign': 'â–',
  'heavy_division_sign': 'â—',
  'spades': 'â™ ï¸',
  'hearts': 'â™¥ï¸',
  'clubs': 'â™£ï¸',
  'diamonds': 'â™¦ï¸',
  'white_flower': 'ğŸ’®',
  '100': 'ğŸ’¯',
  'heavy_check_mark': 'âœ”ï¸',
  'ballot_box_with_check': 'â˜‘ï¸',
  'radio_button': 'ğŸ”˜',
  'link': 'ğŸ”—',
  'curly_loop': 'â°',
  'wavy_dash': 'ã€°ï¸',
  'part_alternation_mark': 'ã€½ï¸',
  'trident': 'ğŸ”±',
  'black_medium_square': 'â—¼ï¸',
  'white_medium_square': 'â—»ï¸',
  'black_medium_small_square': 'â—¾ï¸',
  'white_medium_small_square': 'â—½ï¸',
  'black_small_square': 'â–ªï¸',
  'white_small_square': 'â–«ï¸',
  'black_large_square': 'â¬›ï¸',
  'white_large_square': 'â¬œï¸',
  'black_square_button': 'ğŸ”²',
  'white_square_button': 'ğŸ”³',
  'black_circle': 'âš«ï¸',
  'white_circle': 'âšªï¸',
  'red_circle': 'ğŸ”´',
  'large_blue_circle': 'ğŸ”µ',
  'large_orange_diamond': 'ğŸ”¶',
  'large_blue_diamond': 'ğŸ”·',
  'small_orange_diamond': 'ğŸ”¸',
  'small_blue_diamond': 'ğŸ”¹',
  'small_red_triangle': 'ğŸ”º',
  'small_red_triangle_down': 'ğŸ”»'
};

class EmojiWidget extends WidgetType {
  constructor(readonly emoji: string) {
    super();
  }

  toDOM() {
    const span = document.createElement('span');
    span.className = 'cm-emoji';
    span.textContent = this.emoji;
    return span;
  }
}

function Emojis(view: EditorView) {
  const widgets: Range<Decoration>[] = [];
  const cursorPos = view.state.selection.main.head
  for (const { from, to } of view.visibleRanges) {
    syntaxTree(view.state).iterate({
      from,
      to,
      enter: (node) => {
        if (node.name === 'Emoji' && !(node.from <= cursorPos && cursorPos <= node.to)) {
          const emojiCode = view.state.doc.sliceString(node.from + 1, node.to - 1);
          const emoji = emojiMap[emojiCode];
          if (emoji) {
            const deco = Decoration.replace({
              widget: new EmojiWidget(emoji),
            });
            widgets.push(deco.range(node.from, node.to));
          }
        }
      },
    });
  }
  return Decoration.set(widgets);
}

export const emojiPlugin = ViewPlugin.fromClass(
  class {
    decorations: DecorationSet;

    constructor(view: EditorView) {
      this.decorations = Emojis(view);
    }

    update(update: ViewUpdate) {
      this.decorations = Emojis(update.view);
    }
  },
  {
    decorations: (v) => v.decorations,
  }
);
